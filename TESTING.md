# 系统功能测试指南

## 测试环境准备

### 1. 确认环境要求
- Node.js 16.0+ 已安装
- PostgreSQL 12+ 已安装并运行
- 浏览器支持（Chrome 70+, Firefox 65+, Safari 12+, Edge 79+）

### 2. 数据库准备
```sql
-- 创建数据库
CREATE DATABASE elevator_memo;

-- 连接数据库并执行初始化脚本
\c elevator_memo;
\i database/init.sql;

-- 验证表创建成功
\dt
SELECT * FROM memos LIMIT 5;
```

### 3. 启动系统
```bash
# 方式1: 使用启动脚本
./start-dev.sh  # Linux/Mac
# 或
start-dev.bat   # Windows

# 方式2: 手动启动
# 终端1 - 启动后端
cd backend
npm install
npm run dev

# 终端2 - 启动前端  
cd frontend
npm install
npm run dev
```

### 4. 验证启动状态
- 后端API: http://localhost:3000 (应显示API信息)
- 前端界面: http://localhost:8080 (应显示系统首页)

## 功能测试清单

### ✅ 1. 基础界面测试
- [ ] 首页加载正常，显示备忘录列表
- [ ] 导航菜单功能正常（备忘录管理、新建备忘录）
- [ ] 响应式布局在不同屏幕尺寸下正常显示
- [ ] 页面标题和图标正确显示

### ✅ 2. 备忘录列表功能
- [ ] 备忘录列表正确显示（包含测试数据）
- [ ] 分页功能正常工作
- [ ] 搜索功能可以按单位名称和编号查询
- [ ] 排序功能正常（按创建时间倒序）
- [ ] 列表中的状态标签正确显示

### ✅ 3. 新建备忘录功能

#### 3.1 表单填写测试
- [ ] 备忘录编号自动生成（格式：MEMO-YYYYMMDD-timestamp）
- [ ] 检测日期自动填充为当前日期
- [ ] 所有必填字段验证正常工作
- [ ] 下拉选择框（设备品种）正常工作
- [ ] 不符合情况单选按钮正常工作

#### 3.2 文件上传测试
```
测试步骤：
1. 点击"上传签名图片"按钮
2. 选择图片文件（jpg/png/gif）
3. 验证上传成功并显示预览
4. 测试文件大小限制（超过5MB应提示错误）
5. 测试文件类型限制（非图片文件应提示错误）
6. 测试删除已上传图片功能
```

#### 3.3 电子签名测试
```
测试步骤：
1. 在签名画布区域用鼠标/触摸进行签名
2. 验证签名实时显示
3. 点击"清除"按钮验证清空功能
4. 完成签名后验证签收日期自动填入
5. 清除签名后验证签收日期自动清空
```

#### 3.4 表单提交测试
- [ ] 填写完整信息后可以成功提交
- [ ] 缺少必填字段时显示错误提示
- [ ] 提交成功后跳转到列表页
- [ ] 新创建的备忘录在列表中可见

### ✅ 4. 备忘录详情查看
- [ ] 点击备忘录编号可以查看详情
- [ ] 详情页面所有信息正确显示
- [ ] 签名图片正确显示（如果有）
- [ ] 电子签名正确显示（如果有）
- [ ] 返回按钮功能正常

### ✅ 5. 备忘录操作功能

#### 5.1 复制功能测试
```
测试步骤：
1. 在列表页点击某个备忘录的"复制"按钮
2. 等待复制完成提示
3. 验证列表中出现新的备忘录
4. 检查新备忘录编号是否包含"_COPY_"
5. 验证检测日期是否重置为当前日期
6. 验证签收日期和代表签名是否已清空
```

#### 5.2 删除功能测试
```
测试步骤：
1. 点击某个备忘录的"删除"按钮
2. 验证弹出确认对话框
3. 点击"取消"验证取消功能
4. 再次点击"删除"并确认
5. 验证备忘录从列表中消失
6. 检查相关的签名图片文件是否也被删除
```

### ✅ 6. PDF生成和下载

#### 6.1 PDF下载测试
```
测试步骤：
1. 点击备忘录的"PDF"按钮
2. 等待生成完成
3. 验证浏览器触发下载
4. 检查下载的PDF文件名格式
5. 打开PDF文件验证内容完整性
```

#### 6.2 PDF内容验证
- [ ] 所有表单字段正确显示在PDF中
- [ ] 签名图片正确嵌入PDF
- [ ] 电子签名正确显示在PDF中
- [ ] 不符合情况单选框正确标记
- [ ] 日期格式正确显示
- [ ] 页面布局和样式正确

### ✅ 7. 错误处理测试

#### 7.1 网络错误测试
```
测试步骤：
1. 停止后端服务
2. 在前端尝试各种操作
3. 验证错误提示信息是否友好
4. 重启后端验证系统恢复正常
```

#### 7.2 数据验证测试
```
测试步骤：
1. 尝试提交空表单
2. 输入无效的数据格式
3. 上传过大或错误格式的文件
4. 验证所有错误提示正确显示
```

### ✅ 8. 性能测试

#### 8.1 页面加载性能
- [ ] 首页加载时间 < 3秒
- [ ] 列表查询响应时间 < 2秒  
- [ ] PDF生成时间 < 5秒
- [ ] 文件上传响应时间合理

#### 8.2 大数据量测试
```sql
-- 插入大量测试数据
INSERT INTO memos (memo_number, user_unit_name, installation_location, equipment_type, product_number, registration_cert_no, non_conformance_status, inspection_date)
SELECT 
    'MEMO-' || TO_CHAR(CURRENT_DATE, 'YYYYMMDD') || '-' || generate_series,
    '测试单位' || generate_series,
    '测试地点' || generate_series,
    '客梯',
    'TEST-' || generate_series,
    'REG-' || generate_series,
    0,
    CURRENT_DATE
FROM generate_series(1, 100);
```

### ✅ 9. 浏览器兼容性测试

#### 9.1 主流浏览器测试
- [ ] Chrome 最新版本
- [ ] Firefox 最新版本  
- [ ] Safari 最新版本（Mac）
- [ ] Edge 最新版本

#### 9.2 移动端浏览器测试
- [ ] 移动端Chrome
- [ ] 移动端Safari（iOS）
- [ ] 微信内置浏览器

### ✅ 10. 安全性测试

#### 10.1 输入验证测试
```
测试数据：
- SQL注入: ' OR '1'='1
- XSS攻击: <script>alert('xss')</script>
- 超长字符串: 大于字段长度限制的文本
- 特殊字符: 各种Unicode字符
```

#### 10.2 文件上传安全测试
- [ ] 上传脚本文件（应被拒绝）
- [ ] 上传带恶意代码的图片
- [ ] 测试文件名包含特殊字符
- [ ] 验证文件类型检查的有效性

## 测试报告模板

### 测试环境
- 操作系统: 
- Node.js版本:
- PostgreSQL版本:
- 浏览器版本:
- 测试时间:

### 测试结果汇总
| 测试模块 | 通过用例 | 失败用例 | 通过率 | 备注 |
|---------|----------|----------|--------|------|
| 基础界面 | _/_ | _/_ | _% | |
| 列表功能 | _/_ | _/_ | _% | |
| 新建备忘录 | _/_ | _/_ | _% | |
| 详情查看 | _/_ | _/_ | _% | |
| 操作功能 | _/_ | _/_ | _% | |
| PDF生成 | _/_ | _/_ | _% | |
| 错误处理 | _/_ | _/_ | _% | |
| 性能测试 | _/_ | _/_ | _% | |
| 兼容性 | _/_ | _/_ | _% | |
| 安全性 | _/_ | _/_ | _% | |

### 发现的问题
1. 问题描述:
   - 重现步骤:
   - 预期结果:
   - 实际结果:
   - 严重程度: 高/中/低

### 改进建议
- 功能改进建议
- 性能优化建议  
- 用户体验改进建议

## 自动化测试建议

### 单元测试
```bash
# 后端API测试（建议使用Jest + Supertest）
cd backend
npm install --save-dev jest supertest
npm test

# 前端组件测试（建议使用Vitest + Vue Test Utils）
cd frontend  
npm install --save-dev vitest @vue/test-utils
npm run test
```

### 端到端测试
```bash
# 建议使用Playwright或Cypress
npm install --save-dev @playwright/test
npx playwright test
```

## 测试完成标准

系统通过测试的标准：
- ✅ 所有功能模块测试通过率 > 95%
- ✅ 无严重级别的bug
- ✅ 性能指标满足要求
- ✅ 主流浏览器兼容性良好
- ✅ 安全性测试无重大风险

测试通过后即可进入生产环境部署阶段。